<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Аналитика рынка труда - Отчет</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <style>
        /* Custom gradient background for header and hero sections */
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        /* Enhanced hover effect for cards */
        .card-hover {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .card-hover:hover {
            transform: translateY(-8px); /* Slightly more pronounced lift */
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25); /* Larger, softer shadow */
        }
        /* Consistent spacing for sections */
        .section-spacing {
            padding: 3rem 0; /* Increased vertical padding for more breathing room */
        }
        /* Dropdown menu styling */
        #profileDropdown {
            min-width: 180px;
            transition: opacity 0.2s;
        }
        /* Table specific styling for better aesthetics */
        .report-table th, .report-table td {
            padding: 12px 16px; /* More padding for readability */
            text-align: left;
            border-bottom: 1px solid #e2e8f0; /* Light border for rows */
            white-space: nowrap; /* Prevent wrapping in cells */
        }
        .report-table th {
            background-color: #edf2f7; /* Light gray background for headers */
            font-weight: 600; /* Semi-bold headers */
            color: #4a5568; /* Darker text for headers */
        }
        .report-table tbody tr:hover {
            background-color: #f7fafc; /* Very light hover effect */
        }
        .report-table tbody tr:last-child td {
            border-bottom: none; /* No border for the last row */
        }
        .report-container {
            border-radius: 0.75rem; /* Rounded corners for the main report container */
            overflow: hidden; /* Ensures rounded corners apply to children */
        }
        .report-header {
            background-color: #e0e7ff; /* Light blue background for report header */
            padding: 1.5rem;
            border-bottom: 1px solid #c3dafe;
        }
        /* --- Для анимации сворачивания/разворачивания фильтров --- */
        .filter-group-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }
        .filter-group-content.expanded {
            max-height: 500px; /* Достаточно для большинства фильтров */
        }
        /* Print-specific styles for A4 format */
        @media print {
            @page {
                size: A4 landscape; /* Use landscape for wider table */
                margin: 1cm;
            }
            body {
                font-size: 8pt; /* Smaller font for print */
                line-height: 1.2;
                color: #000;
                background-color: #fff !important;
            }
            header, nav, footer, button, .spinner, .pagination, .filter-section-controls, #downloadReportDropdownContainer {
                display: none !important;
            }
            input, select, textarea {
                display: block !important;
                color: #000 !important;
                border: none !important;
                padding: 0 !important;
            }
            section {
                display: block !important;
                padding: 0.2cm 0 !important; /* Reduced padding for print */
                background: none !important;
                box-shadow: none !important;
            }
            .gradient-bg {
                background: none !important;
                color: #000 !important;
            }
            .gradient-bg h2, .gradient-bg p {
                color: #000 !important;
            }
            .gradient-bg .bg-opacity-20 {
                background: none !important;
                backdrop-filter: none !important;
                border: 1px solid #ddd;
            }
            .chart-container {
                height: auto !important;
                width: 100% !important;
                page-break-inside: avoid;
            }
            canvas {
                max-width: 100% !important;
                height: auto !important;
                background: none !important;
            }
            .bg-white, .bg-gray-50, .bg-blue-50, .bg-yellow-50, .bg-green-50 {
                background: #fff !important;
                box-shadow: none !important;
                border: 1px solid #eee;
            }
            .text-white {
                color: #000 !important;
            }
            h1, h2, h3, h4, p, span, li, a {
                color: #000 !important;
            }
            a {
                text-decoration: underline;
            }
            a[href]:after {
                content: " (" attr(href) ")";
                font-size: 6pt; /* Smaller font for href in print */
            }
            a[href^="#"]:after {
                content: "";
            }
            .section-spacing {
                page-break-after: always;
            }
            .section-spacing:last-child {
                page-break-after: auto;
            }
            .report-table th, .report-table td {
                padding: 5px 8px; /* Even less padding for print table */
                font-size: 8pt;
            }
        }
        /* --- Для аккуратности виджетов --- */
        .dashboard-card {
            min-height: 140px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }
        .dashboard-card i {
            margin-bottom: 0.5rem;
            font-size: 2.5rem;
        }
        .chart-container {
            background: #fff;
            border-radius: 1rem;
            box-shadow: 0 2px 12px 0 rgba(0,0,0,0.04);
            padding: 2rem 1.5rem 1.5rem 1.5rem;
            margin-bottom: 1rem;
        }
        /* Chart.js аккуратность */
        canvas {
            background: none !important;
        }
        /* Для фильтра зарплаты */
        .salary-input-suffix {
            position: absolute;
            right: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: #6b7280;
            font-size: 0.95em;
        }
    </style>
</head>
<body class="bg-gray-100 font-sans">
    <header class="gradient-bg text-white shadow-lg">
        <div class="container mx-auto px-4 py-6">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <img src="https://placehold.co/40x40/ffffff/000000?text=Лого" alt="Изображение логотипа МТМЗН" class="rounded-full">
                    <div>
                        <h1 class="text-2xl font-bold">Портал рынка труда</h1>
                        <p class="text-sm opacity-90">Республика Таджикистан</p>
                    </div>
                </div>
                <nav class="hidden md:flex space-x-6 items-center">
                    <a href="#" class="hover:text-yellow-300 transition-colors">Вакансии</a>
                    <a href="#" class="hover:text-yellow-300 transition-colors">Статистика</a>
                    <a href="#" class="hover:text-yellow-300 transition-colors">Поиск вакансий</a>
                    <a href="#" class="hover:text-yellow-300 transition-colors">Программы</a>
                    <a href="#" class="hover:text-yellow-300 transition-colors">Образование</a>
                    <a href="#" class="hover:text-yellow-300 transition-colors">ИИ Инструменты</a>
                    <div class="relative" id="profileDropdownContainer">
                        <button id="profileMenuBtn" class="relative hover:text-yellow-300 transition-colors focus:outline-none ml-2">Мой профиль</button>
                        <div id="profileDropdown" class="absolute right-0 mt-2 w-56 bg-white rounded-lg shadow-lg py-2 z-50 hidden">
                            <a href="#" class="block px-4 py-2 text-gray-800 hover:bg-gray-100">Вход для работодателя</a>
                            <a href="#" class="block px-4 py-2 text-gray-800 hover:bg-gray-100">Вход для соискателя</a>
                            <a href="#" class="block px-4 py-2 text-gray-800 hover:bg-gray-100">Регистрация</a>
                        </div>
                    </div>
                </nav>
            </div>
        </div>
    </header>

    <main class="container mx-auto px-4 py-8">
        <section id="analytics-overview" class="section-spacing bg-white">
            <div class="container mx-auto px-4">
                <h2 class="text-3xl font-bold text-center mb-12 text-gray-800">Аналитика рынка труда</h2>
                
                <div class="bg-white p-8 rounded-lg shadow-xl mb-12">
                    <h3 class="text-2xl font-semibold mb-6 text-gray-800">Настраиваемые фильтры</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <div class="border-b border-gray-200 pb-4">
                            <button class="flex justify-between items-center w-full text-left font-semibold text-gray-800 mb-2 filter-toggle" data-target="periodFilter">
                                Период <i class="fas fa-chevron-up text-sm"></i>
                            </button>
                            <div id="periodFilter" class="filter-group-content">
                                <div class="space-y-2">
                                    <label class="flex items-center">
                                        <input type="radio" name="period" value="year" class="form-radio text-blue-600 rounded">
                                        <span class="ml-2 text-gray-700">Год</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="radio" name="period" value="quarter" class="form-radio text-blue-600 rounded">
                                        <span class="ml-2 text-gray-700">Квартал</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="radio" name="period" value="month" class="form-radio text-blue-600 rounded" checked>
                                        <span class="ml-2 text-gray-700">Месяц</span>
                                    </label>
                                    <select id="selectYear" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-gray-800 mt-2"></select>
                                    <select id="selectQuarter" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-gray-800 mt-2 hidden">
                                        <option value="Q1">Q1</option>
                                        <option value="Q2">Q2</option>
                                        <option value="Q3">Q3</option>
                                        <option value="Q4">Q4</option>
                                    </select>
                                    <select id="selectMonth" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-gray-800 mt-2"></select>
                                </div>
                            </div>
                        </div>

                        <div class="border-b border-gray-200 pb-4">
                            <button class="flex justify-between items-center w-full text-left font-semibold text-gray-800 mb-2 filter-toggle" data-target="regionFilter">
                                Регион <i class="fas fa-chevron-down text-sm"></i>
                            </button>
                            <div id="regionFilter" class="filter-group-content">
                                <div class="space-y-2">
                                    <label class="flex items-center">
                                        <input type="checkbox" name="region" value="Душанбе" class="form-checkbox text-blue-600 rounded" checked>
                                        <span class="ml-2 text-gray-700">Душанбе</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" name="region" value="Согдийская область" class="form-checkbox text-blue-600 rounded">
                                        <span class="ml-2 text-gray-700">Согдийская область</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" name="region" value="Хатлонская область" class="form-checkbox text-blue-600 rounded">
                                        <span class="ml-2 text-gray-700">Хатлонская область</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" name="region" value="ГБАО" class="form-checkbox text-blue-600 rounded">
                                        <span class="ml-2 text-gray-700">ГБАО</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" name="region" value="Районы республиканского подчинения" class="form-checkbox text-blue-600 rounded">
                                        <span class="ml-2 text-gray-700">Районы республиканского подчинения</span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <div class="border-b border-gray-200 pb-4">
                            <button class="flex justify-between items-center w-full text-left font-semibold text-gray-800 mb-2 filter-toggle" data-target="industryFilter">
                                Отрасль <i class="fas fa-chevron-down text-sm"></i>
                            </button>
                            <div id="industryFilter" class="filter-group-content">
                                <div class="space-y-2">
                                    <label class="flex items-center">
                                        <input type="checkbox" name="industry" value="IT" class="form-checkbox text-blue-600 rounded" checked>
                                        <span class="ml-2 text-gray-700">IT</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" name="industry" value="Строительство" class="form-checkbox text-blue-600 rounded">
                                        <span class="ml-2 text-gray-700">Строительство</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" name="industry" value="Торговля" class="form-checkbox text-blue-600 rounded">
                                        <span class="ml-2 text-gray-700">Торговля</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" name="industry" value="Образование" class="form-checkbox text-blue-600 rounded">
                                        <span class="ml-2 text-gray-700">Образование</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" name="industry" value="Здравоохранение" class="form-checkbox text-blue-600 rounded">
                                        <span class="ml-2 text-gray-700">Здравоохранение</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" name="industry" value="Производство" class="form-checkbox text-blue-600 rounded">
                                        <span class="ml-2 text-gray-700">Производство</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" name="industry" value="Финансы" class="form-checkbox text-blue-600 rounded">
                                        <span class="ml-2 text-gray-700">Финансы</span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <div class="border-b border-gray-200 pb-4">
                            <button class="flex justify-between items-center w-full text-left font-semibold text-gray-800 mb-2 filter-toggle" data-target="dataTypeFilter">
                                Тип данных <i class="fas fa-chevron-down text-sm"></i>
                            </button>
                            <div id="dataTypeFilter" class="filter-group-content">
                                <div class="space-y-2">
                                    <label class="flex items-center">
                                        <input type="checkbox" name="dataType" value="Вакансии" class="form-checkbox text-blue-600 rounded" checked>
                                        <span class="ml-2 text-gray-700">Вакансии</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" name="dataType" value="Резюме" class="form-checkbox text-blue-600 rounded">
                                        <span class="ml-2 text-gray-700">Резюме</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" name="dataType" value="Трудоустройства" class="form-checkbox text-blue-600 rounded">
                                        <span class="ml-2 text-gray-700">Трудоустройства</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" name="dataType" value="Уровень безработицы" class="form-checkbox text-blue-600 rounded">
                                        <span class="ml-2 text-gray-700">Уровень безработицы</span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <div class="border-b border-gray-200 pb-4">
                            <button class="flex justify-between items-center w-full text-left font-semibold text-gray-800 mb-2 filter-toggle" data-target="ageGroupFilter">
                                Возрастная группа <i class="fas fa-chevron-down text-sm"></i>
                            </button>
                            <div id="ageGroupFilter" class="filter-group-content">
                                <div class="space-y-2">
                                    <label class="flex items-center">
                                        <input type="checkbox" name="ageGroup" value="18-25" class="form-checkbox text-blue-600 rounded">
                                        <span class="ml-2 text-gray-700">18-25</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" name="ageGroup" value="26-35" class="form-checkbox text-blue-600 rounded">
                                        <span class="ml-2 text-gray-700">26-35</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" name="ageGroup" value="36-50" class="form-checkbox text-blue-600 rounded">
                                        <span class="ml-2 text-gray-700">36-50</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" name="ageGroup" value="50+" class="form-checkbox text-blue-600 rounded">
                                        <span class="ml-2 text-gray-700">50+</span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <div class="border-b border-gray-200 pb-4">
                            <button class="flex justify-between items-center w-full text-left font-semibold text-gray-800 mb-2 filter-toggle" data-target="genderFilter">
                                Пол <i class="fas fa-chevron-down text-sm"></i>
                            </button>
                            <div id="genderFilter" class="filter-group-content">
                                <div class="space-y-2">
                                    <label class="flex items-center">
                                        <input type="radio" name="gender" value="Мужской" class="form-radio text-blue-600 rounded">
                                        <span class="ml-2 text-gray-700">Мужской</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="radio" name="gender" value="Женский" class="form-radio text-blue-600 rounded">
                                        <span class="ml-2 text-gray-700">Женский</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="radio" name="gender" value="Не имеет значения" class="form-radio text-blue-600 rounded" checked>
                                        <span class="ml-2 text-gray-700">Не имеет значения</span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <div class="border-b border-gray-200 pb-4">
                            <button class="flex justify-between items-center w-full text-left font-semibold text-gray-800 mb-2 filter-toggle" data-target="educationLevelFilter">
                                Уровень образования <i class="fas fa-chevron-down text-sm"></i>
                            </button>
                            <div id="educationLevelFilter" class="filter-group-content">
                                <div class="space-y-2">
                                    <label class="flex items-center">
                                        <input type="checkbox" name="educationLevel" value="Среднее" class="form-checkbox text-blue-600 rounded">
                                        <span class="ml-2 text-gray-700">Среднее</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" name="educationLevel" value="Среднее специальное" class="form-checkbox text-blue-600 rounded">
                                        <span class="ml-2 text-gray-700">Среднее специальное</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" name="educationLevel" value="Высшее" class="form-checkbox text-blue-600 rounded">
                                        <span class="ml-2 text-gray-700">Высшее</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" name="educationLevel" value="Послевузовское" class="form-checkbox text-blue-600 rounded">
                                        <span class="ml-2 text-gray-700">Послевузовское</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" name="educationLevel" value="Безработный" class="form-checkbox text-blue-600 rounded" checked>
                                        <span class="ml-2 text-gray-700">Безработный</span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <div class="border-b border-gray-200 pb-4">
                            <button class="flex justify-between items-center w-full text-left font-semibold text-gray-800 mb-2 filter-toggle" data-target="experienceFilter">
                                Опыт работы <i class="fas fa-chevron-down text-sm"></i>
                            </button>
                            <div id="experienceFilter" class="filter-group-content">
                                <div class="space-y-2">
                                    <label class="flex items-center">
                                        <input type="checkbox" name="experience" value="Без опыта" class="form-checkbox text-blue-600 rounded">
                                        <span class="ml-2 text-gray-700">Без опыта</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" name="experience" value="1-3 года" class="form-checkbox text-blue-600 rounded">
                                        <span class="ml-2 text-gray-700">1-3 года</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" name="experience" value="3-5 лет" class="form-checkbox text-blue-600 rounded">
                                        <span class="ml-2 text-gray-700">3-5 лет</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" name="experience" value="Более 5 лет" class="form-checkbox text-blue-600 rounded">
                                        <span class="ml-2 text-gray-700">Более 5 лет</span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <div class="border-b border-gray-200 pb-4">
                            <button class="flex justify-between items-center w-full text-left font-semibold text-gray-800 mb-2 filter-toggle" data-target="socialStatusFilter">
                                Социальный статус <i class="fas fa-chevron-down text-sm"></i>
                            </button>
                            <div id="socialStatusFilter" class="filter-group-content">
                                <div class="space-y-2">
                                    <label class="flex items-center">
                                        <input type="checkbox" name="socialStatus" value="Недавно освободившийся из мест лишения свободы" class="form-checkbox text-blue-600 rounded">
                                        <span class="ml-2 text-gray-700">Недавно освободившийся из мест лишения свободы</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" name="socialStatus" value="Лицо с инвалидностью" class="form-checkbox text-blue-600 rounded">
                                        <span class="ml-2 text-gray-700">Лицо с инвалидностью</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" name="socialStatus" value="Многодетный родитель" class="form-checkbox text-blue-600 rounded">
                                        <span class="ml-2 text-gray-700">Многодетный родитель</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" name="socialStatus" value="Молодой специалист" class="form-checkbox text-blue-600 rounded">
                                        <span class="ml-2 text-gray-700">Молодой специалист</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" name="socialStatus" value="Ветеран труда" class="form-checkbox text-blue-600 rounded">
                                        <span class="ml-2 text-gray-700">Ветеран труда</span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <div class="border-b border-gray-200 pb-4">
                            <button class="flex justify-between items-center w-full text-left font-semibold text-gray-800 mb-2 filter-toggle" data-target="keywordsFilter">
                                Ключевые слова <i class="fas fa-chevron-down text-sm"></i>
                            </button>
                            <div id="keywordsFilter" class="filter-group-content">
                                <div class="space-y-2">
                                    <input type="text" id="keywordsInput" name="keywords" placeholder="Например: Python, Маркетинг" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-gray-800">
                                </div>
                            </div>
                        </div>

                        <div class="border-b border-gray-200 pb-4">
                            <button class="flex justify-between items-center w-full text-left font-semibold text-gray-800 mb-2 filter-toggle" data-target="salaryFilter">
                                Уровень заработной платы (сомони) <i class="fas fa-chevron-down text-sm"></i>
                            </button>
                            <div id="salaryFilter" class="filter-group-content">
                                <div class="flex gap-2">
                                    <div class="relative w-1/2">
                                        <input type="number" id="salaryMinInput" name="salaryMin" placeholder="От" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-gray-800 pr-12">
                                        <span class="salary-input-suffix" style="right:1rem;">сомони</span>
                                    </div>
                                    <div class="relative w-1/2">
                                        <input type="number" id="salaryMaxInput" name="salaryMax" placeholder="До" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-gray-800 pr-12">
                                        <span class="salary-input-suffix" style="right:1rem;">сомони</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="border-b border-gray-200 pb-4">
                            <button class="flex justify-between items-center w-full text-left font-semibold text-gray-800 mb-2 filter-toggle" data-target="employmentTypeFilter">
                                Тип занятости <i class="fas fa-chevron-down text-sm"></i>
                            </button>
                            <div id="employmentTypeFilter" class="filter-group-content">
                                <div class="space-y-2">
                                    <label class="flex items-center">
                                        <input type="radio" name="employmentType" value="Полная занятость" class="form-radio text-blue-600 rounded" checked>
                                        <span class="ml-2 text-gray-700">Полная занятость</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="radio" name="employmentType" value="Частичная занятость" class="form-radio text-blue-600 rounded">
                                        <span class="ml-2 text-gray-700">Частичная занятость</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="radio" name="employmentType" value="Проектная работа / Фриланс" class="form-radio text-blue-600 rounded">
                                        <span class="ml-2 text-gray-700">Проектная работа / Фриланс</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="radio" name="employmentType" value="Временная работа" class="form-radio text-blue-600 rounded">
                                        <span class="ml-2 text-gray-700">Временная работа</span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <div class="border-b border-gray-200 pb-4">
                            <button class="flex justify-between items-center w-full text-left font-semibold text-gray-800 mb-2 filter-toggle" data-target="companyTypeFilter">
                                Тип компании <i class="fas fa-chevron-down text-sm"></i>
                            </button>
                            <div id="companyTypeFilter" class="filter-group-content">
                                <div class="space-y-2">
                                    <label class="flex items-center">
                                        <input type="radio" name="companyType" value="Прямой работодатель" class="form-radio text-blue-600 rounded" checked>
                                        <span class="ml-2 text-gray-700">Прямой работодатель</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="radio" name="companyType" value="Кадровое агентство" class="form-radio text-blue-600 rounded">
                                        <span class="ml-2 text-gray-700">Кадровое агентство</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="mt-6 flex flex-col sm:flex-row justify-center gap-4 filter-section-controls">
                        <button id="applyFiltersBtn" class="bg-blue-500 text-white px-6 py-3 rounded-lg font-semibold hover:bg-blue-600 transition-colors">
                            Применить фильтры
                        </button>
                        <button id="generateReportBtn" class="bg-purple-500 text-white px-6 py-3 rounded-lg font-semibold hover:bg-purple-600 transition-colors flex items-center justify-center">
                            <span id="reportLoadingSpinner" class="hidden spinner mr-2"></span>
                            Сгенерировать отчет
                        </button>
                    </div>
                </div>
                
                <div id="reportOutputContainer" class="bg-white p-8 rounded-lg shadow-xl mb-12 hidden">
                    <h3 class="text-2xl font-semibold mb-6 text-gray-800">Сгенерированный отчет</h3>
                    <p class="text-md font-semibold text-gray-700">Ниже представлена таблица, которая отображает случайные комбинации выбранных параметров фильтров:</p>
                    <div class="p-6 overflow-x-auto">
                        <table class="min-w-full bg-white report-table rounded-lg shadow-md">
                            <thead>
                                <tr>
                                    <th class="px-4 py-2 text-left text-sm font-semibold text-gray-700 rounded-tl-lg">Период</th>
                                    <th class="px-4 py-2 text-left text-sm font-semibold text-gray-700">Регионы</th>
                                    <th class="px-4 py-2 text-left text-sm font-semibold text-gray-700">Отрасли</th>
                                    <th class="px-4 py-2 text-left text-sm font-semibold text-gray-700">Типы данных</th>
                                    <th class="px-4 py-2 text-left text-sm font-semibold text-gray-700">Возрастные группы</th>
                                    <th class="px-4 py-2 text-left text-sm font-semibold text-gray-700">Пол</th>
                                    <th class="px-4 py-2 text-left text-sm font-semibold text-gray-700">Уровень образования</th>
                                    <th class="px-4 py-2 text-left text-sm font-semibold text-gray-700">Опыт работы</th>
                                    <th class="px-4 py-2 text-left text-sm font-semibold text-gray-700">Социальный статус</th>
                                    <th class="px-4 py-2 text-left text-sm font-semibold text-gray-700">Ключевые слова</th>
                                    <th class="px-4 py-2 text-left text-sm font-semibold text-gray-700">Зарплата</th>
                                    <th class="px-4 py-2 text-left text-sm font-semibold text-gray-700">Тип занятости</th>
                                    <th class="px-4 py-2 text-left text-sm font-semibold text-gray-700 rounded-tr-lg">Тип компании</th>
                                </tr>
                            </thead>
                            <tbody id="reportTableBody">
                                </tbody>
                        </table>
                    </div>

                    <div class="p-6 border-t border-gray-200 flex justify-center">
                        <div class="relative inline-block text-left" id="downloadReportDropdownContainer">
                            <button type="button" class="inline-flex justify-center w-full rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-100 focus:ring-indigo-500" id="downloadMenuButton" aria-expanded="true" aria-haspopup="true">
                                Скачать отчет <i class="fas fa-chevron-down ml-2 -mr-1 text-sm"></i>
                            </button>
                            <div class="origin-top-right absolute right-0 mt-2 w-56 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 focus:outline-none hidden" role="menu" aria-orientation="vertical" aria-labelledby="downloadMenuButton" tabindex="-1" id="downloadDropdownMenu">
                                <div class="py-1" role="none">
                                    <a href="#" class="text-gray-700 block px-4 py-2 text-sm hover:bg-gray-100" role="menuitem" tabindex="-1" id="downloadJson">JSON</a>
                                    <a href="#" class="text-gray-700 block px-4 py-2 text-sm hover:bg-gray-100" role="menuitem" tabindex="-1" id="downloadCsv">CSV</a>
                                    <a href="#" class="text-gray-700 block px-4 py-2 text-sm hover:bg-gray-100" role="menuitem" tabindex="-1" id="downloadPdf">PDF</a>
                                    <a href="#" class="text-gray-700 block px-4 py-2 text-sm hover:bg-gray-100" role="menuitem" tabindex="-1" id="downloadXlsx">XLSX</a>
                                    <a href="#" class="text-gray-700 block px-4 py-2 text-sm hover:bg-gray-100" role="menuitem" tabindex="-1" id="downloadGsheet">GSHEET</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="grid md:grid-cols-4 gap-6 mb-12">
                    <div class="bg-blue-500 text-white rounded-lg p-6 text-center shadow-lg card-hover dashboard-card">
                        <i class="fas fa-briefcase"></i>
                        <h3 class="text-2xl font-bold">15,230</h3>
                        <p class="text-sm opacity-90">Активных вакансий</p>
                    </div>
                    <div class="bg-green-500 text-white rounded-lg p-6 text-center shadow-lg card-hover dashboard-card">
                        <i class="fas fa-users"></i>
                        <h3 class="text-2xl font-bold">52,100</h3>
                        <p class="text-sm opacity-90">Зарегистрированных соискателей</p>
                    </div>
                    <div class="bg-purple-500 text-white rounded-lg p-6 text-center shadow-lg card-hover dashboard-card">
                        <i class="fas fa-handshake"></i>
                        <h3 class="text-2xl font-bold">9,876</h3>
                        <p class="text-sm opacity-90">Успешных трудоустройств</p>
                    </div>
                    <div class="bg-yellow-500 text-white rounded-lg p-6 text-center shadow-lg card-hover dashboard-card">
                        <i class="fas fa-chart-line"></i>
                        <h3 class="text-2xl font-bold">6.5%</h3>
                        <p class="text-sm opacity-90">Средний уровень безработицы</p>
                    </div>
                </div>

                <div class="grid lg:grid-cols-2 gap-8 mb-12">

                    <!-- Виджет: Динамика вакансий по месяцам -->
                    <div class="bg-white rounded-lg p-6 shadow-lg lg:col-span-2">
                        <h3 class="text-xl font-semibold mb-4 text-gray-800 text-center">Динамика вакансий по месяцам</h3>
                        <div class="chart-container" style="height:320px;max-width:100%;">
                            <canvas id="vacanciesTrendChart"></canvas>
                        </div>
                    </div>
                    <div class="bg-white rounded-lg p-6 shadow-lg flex flex-col items-center justify-start min-h-[340px]">
                        <h3 class="text-xl font-semibold mb-4 text-gray-800 text-center w-full">Распределение вакансий по отраслям</h3>
                        <div class="flex flex-col items-center flex-1 justify-center w-full">
                            <canvas id="industryDistributionChart" width="220" height="220" style="max-width:220px;max-height:220px;"></canvas>
                            <div id="industryLegend" class="legend-block mt-4"></div>
                        </div>
                    </div>
                    <div class="bg-white rounded-lg p-6 shadow-lg flex flex-col items-center justify-start min-h-[340px]">
                        <h3 class="text-xl font-semibold mb-4 text-gray-800 text-center w-full">Гендерное распределение рынка труда</h3>
                        <div class="flex flex-col items-center flex-1 justify-center w-full">
                            <canvas id="genderDistributionChart" width="220" height="220" style="max-width:220px;max-height:220px;"></canvas>
                            <div id="genderLegend" class="legend-block mt-4"></div>
                        </div>
                    </div>
                    <div class="bg-white rounded-lg p-6 shadow-lg lg:col-span-2">
                        <h3 class="text-xl font-semibold mb-4 text-gray-800 text-center">Уровень безработицы по регионам (тренды)</h3>
                        <div class="chart-container">
                            <canvas id="regionalUnemploymentChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Удалённый второй виджет "Динамика вакансий по месяцам" ниже -->
            </div>
        </section>
    </main>

    <footer class="gradient-bg text-white py-12">
        <div class="container mx-auto px-4">
            <div class="grid md:grid-cols-4 gap-8">
                <div>
                    <h3 class="text-lg font-semibold mb-4">О портале</h3>
                    <p class="text-sm opacity-90">Официальный портал информационной системы рынка труда Республики Таджикистан</p>
                </div>
                <div>
                    <h3 class="text-lg font-semibold mb-4">Полезные ссылки</h3>
                    <ul class="space-y-2 text-sm">
                        <li><a href="#" class="opacity-90 hover:opacity-100">Правительство РТ</a></li>
                        <li><a href="#" class="opacity-90 hover:opacity-100">Министерство труда</a></li>
                        <li><a href="#" class="opacity-90 hover:opacity-100">Налоговый комитет</a></li>
                        <li><a href="#" class="opacity-90 hover:opacity-100">Нормативные акты</a></li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-lg font-semibold mb-4">Поддержка</h3>
                    <ul class="space-y-2 text-sm">
                        <li><a href="#" class="opacity-90 hover:opacity-100">Часто задаваемые вопросы</a></li>
                        <li><a href="#" class="opacity-90 hover:opacity-100">Руководство пользователя</a></li>
                        <li><a href="#" class="opacity-90 hover:opacity-100">Техническая поддержка</a></li>
                        <li><a href="#" class="opacity-90 hover:opacity-100">Обратная связь</a></li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-lg font-semibold mb-4">Социальные сети</h3>
                    <div class="flex space-x-4">
                        <a href="#" class="text-2xl opacity-90 hover:opacity-100"><i class="fab fa-facebook"></i></a>
                        <a href="#" class="text-2xl opacity-90 hover:opacity-100"><i class="fab fa-twitter"></i></a>
                        <a href="#" class="text-2xl opacity-90 hover:opacity-100"><i class="fab fa-telegram"></i></a>
                        <a href="#" class="text-2xl opacity-90 hover:opacity-100"><i class="fab fa-instagram"></i></a>
                    </div>
                </div>
            </div>
            <div class="border-t border-white border-opacity-20 mt-8 pt-8 text-center">
                <p class="text-sm opacity-90">&copy; 2024 Министерство труда, миграции и занятости населения Республики Таджикистан. Все права защищены.</p>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Global state object for filters (not directly used for report generation in this version, but kept for filter form)
        let currentFiltersState = {
            period: 'month',
            year: new Date().getFullYear(),
            quarter: 'Q1',
            month: new Date().getMonth() + 1,
            regions: ['Душанбе'],
            industries: ['IT'],
            dataTypes: ['Вакансии'],
            ageGroups: [],
            gender: 'Не имеет значения',
            educationLevels: ['Безработный'],
            experience: [],
            socialStatus: [],
            keywords: '',
            salaryMin: '',
            salaryMax: '',
            employmentType: 'Полная занятость',
            companyType: 'Прямой работодатель'
        };

        const months = ['Январь', 'Февраль', 'Март', 'Апрель', 'Май', 'Июнь', 'Июль', 'Август', 'Сентябрь', 'Октябрь', 'Ноябрь', 'Декабрь'];

        // Helper function to get a random element from an array
        function getRandomElement(arr) {
            return arr[Math.floor(Math.random() * arr.length)];
        }

        // Helper function to get a random subset of elements from an array
        function getRandomSubset(arr, minCount, maxCount) {
            const count = Math.floor(Math.random() * (maxCount - minCount + 1)) + minCount;
            const shuffled = arr.sort(() => 0.5 - Math.random());
            return shuffled.slice(0, count);
        }

        // Data for random filter value generation
        const allRegions = ['Душанбе', 'Согдийская область', 'Хатлонская область', 'ГБАО', 'Районы республиканского подчинения'];
        const allIndustries = ['IT', 'Строительство', 'Торговля', 'Образование', 'Здравоохранение', 'Производство', 'Финансы'];
        const allDataTypes = ['Вакансии', 'Резюме', 'Трудоустройства', 'Уровень безработицы'];
        const allAgeGroups = ['18-25', '26-35', '36-50', '50+', 'Все возрастные группы'];
        const allGenders = ['Мужской', 'Женский', 'Не имеет значения'];
        const allEducationLevels = ['Среднее', 'Среднее специальное', 'Высшее', 'Послевузовское', 'Безработный'];
        const allExperienceLevels = ['Без опыта', '1-3 года', '3-5 лет', 'Более 5 лет', 'Любой опыт работы'];
        const allSocialStatuses = ['Недавно освободившийся из мест лишения свободы', 'Лицо с инвалидностью', 'Многодетный родитель', 'Молодой специалист', 'Ветеран труда', 'Все социальные статусы'];
        const allKeywords = ['Python', 'Маркетинг', 'Продажи', 'Бухгалтерия', 'Медицина', 'Строитель', 'Учитель', 'Не указаны'];
        const allEmploymentTypes = ['Полная занятость', 'Частичная занятость', 'Проектная работа / Фриланс', 'Временная работа'];
        const allCompanyTypes = ['Прямой работодатель', 'Кадровое агентство'];

        // Function to generate a single random report row
        function generateRandomReportRow() {
            const periodType = getRandomElement(['year', 'quarter', 'month']);
            let periodValue = '';
            const randomYear = Math.floor(Math.random() * 3) + 2022; // 2022-2024
            const randomMonth = Math.floor(Math.random() * 12); // 0-11
            const randomQuarter = `Q${Math.floor(Math.random() * 4) + 1}`;

            if (periodType === 'year') {
                periodValue = `Год ${randomYear}`;
            } else if (periodType === 'quarter') {
                periodValue = `Квартал ${randomQuarter} ${randomYear}`;
            } else { // month
                periodValue = `Месяц ${months[randomMonth]} ${randomYear}`;
            }

            const regions = getRandomSubset(allRegions, 1, 3).join(', ') || 'Все регионы';
            const industries = getRandomSubset(allIndustries, 1, 2).join(', ') || 'Все отрасли';
            const dataTypes = getRandomSubset(allDataTypes, 1, 2).join(', ') || 'Все типы данных';
            const ageGroups = getRandomElement(allAgeGroups);
            const gender = getRandomElement(allGenders);
            const educationLevel = getRandomSubset(allEducationLevels, 1, 2).join(', ') || 'Все уровни образования';
            const experience = getRandomElement(allExperienceLevels);
            const socialStatus = getRandomElement(allSocialStatuses);
            const keywords = getRandomElement(allKeywords);

            let salary = '';
            if (Math.random() > 0.3) { // 70% chance to have salary
                const minSalary = Math.floor(Math.random() * (5000 - 2000 + 1)) + 2000;
                const maxSalary = minSalary + Math.floor(Math.random() * (10000 - 3000 + 1)) + 3000;
                salary = `От ${minSalary} - До ${maxSalary} ₽`;
            } else {
                salary = 'Не указана';
            }
            
            const employmentType = getRandomElement(allEmploymentTypes);
            const companyType = getRandomElement(allCompanyTypes);

            return {
                period: periodValue,
                regions: regions,
                industries: industries,
                dataTypes: dataTypes,
                ageGroups: ageGroups,
                gender: gender,
                educationLevel: educationLevel,
                experience: experience,
                socialStatus: socialStatus,
                keywords: keywords,
                salary: salary,
                employmentType: employmentType,
                companyType: companyType
            };
        }

        // Function to render the report table
        function renderReportTable(numRows = 5) {
            const reportTableBody = document.getElementById('reportTableBody');
            if (!reportTableBody) {
                console.error("Элемент с ID 'reportTableBody' не найден.");
                return;
            }
            reportTableBody.innerHTML = '';

            for (let i = 0; i < numRows; i++) {
                const rowData = generateRandomReportRow();
                const row = document.createElement('tr');
                row.className = 'border-b border-gray-200 hover:bg-gray-50';
                row.innerHTML = `
                    <td class="px-4 py-2 text-sm text-gray-800">${rowData.period}</td>
                    <td class="px-4 py-2 text-sm text-gray-800">${rowData.regions}</td>
                    <td class="px-4 py-2 text-sm text-gray-800">${rowData.industries}</td>
                    <td class="px-4 py-2 text-sm text-gray-800">${rowData.dataTypes}</td>
                    <td class="px-4 py-2 text-sm text-gray-800">${rowData.ageGroups}</td>
                    <td class="px-4 py-2 text-sm text-gray-800">${rowData.gender}</td>
                    <td class="px-4 py-2 text-sm text-gray-800">${rowData.educationLevel}</td>
                    <td class="px-4 py-2 text-sm text-gray-800">${rowData.experience}</td>
                    <td class="px-4 py-2 text-sm text-gray-800">${rowData.socialStatus}</td>
                    <td class="px-4 py-2 text-sm text-gray-800">${rowData.keywords}</td>
                    <td class="px-4 py-2 text-sm text-gray-800">${rowData.salary}</td>
                    <td class="px-4 py-2 text-sm text-gray-800">${rowData.employmentType}</td>
                    <td class="px-4 py-2 text-sm text-gray-800">${rowData.companyType}</td>
                `;
                reportTableBody.appendChild(row);
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            // Profile Dropdown Logic (Existing)
            const profileMenuBtn = document.getElementById('profileMenuBtn');
            const profileDropdown = document.getElementById('profileDropdown');
            const profileDropdownContainer = document.getElementById('profileDropdownContainer');

            if (profileMenuBtn) {
                profileMenuBtn.onclick = function(e) {
                    e.stopPropagation();
                    profileDropdown.classList.toggle('hidden');
                };
            }

            document.addEventListener('click', function(e) {
                if (profileDropdownContainer && !profileDropdownContainer.contains(e.target)) {
                    profileDropdown.classList.add('hidden');
                }
            });

            // Download Report Dropdown Logic (Existing)
            const downloadMenuButton = document.getElementById('downloadMenuButton');
            const downloadDropdownMenu = document.getElementById('downloadDropdownMenu');

            if (downloadMenuButton) {
                downloadMenuButton.addEventListener('click', (e) => {
                    e.stopPropagation();
                    downloadDropdownMenu.classList.toggle('hidden');
                });
            }

            document.addEventListener('click', (e) => {
                const downloadReportDropdownContainer = document.getElementById('downloadReportDropdownContainer');
                if (downloadReportDropdownContainer && !downloadReportDropdownContainer.contains(e.target)) {
                    downloadDropdownMenu.classList.add('hidden');
                }
            });

            // Placeholder download functions (Existing)
            document.getElementById('downloadJson').addEventListener('click', () => alert('Скачать отчет в формате JSON'));
            document.getElementById('downloadCsv').addEventListener('click', () => alert('Скачать отчет в формате CSV'));
            document.getElementById('downloadPdf').addEventListener('click', () => alert('Скачать отчет в формате PDF'));
            document.getElementById('downloadXlsx').addEventListener('click', () => alert('Скачать отчет в формате XLSX'));
            document.getElementById('downloadGsheet').addEventListener('click', () => alert('Скачать отчет в формате GSHEET'));

            // Filter section toggle functionality (Existing)
            document.querySelectorAll('.filter-toggle').forEach(button => {
                button.addEventListener('click', () => {
                    const targetId = button.dataset.target;
                    const targetContent = document.getElementById(targetId);
                    const icon = button.querySelector('i');

                    if (targetContent) { // Added null check
                        targetContent.classList.toggle('expanded');

                        if (targetContent.classList.contains('expanded')) {
                            targetContent.style.maxHeight = targetContent.scrollHeight + "px";
                            if (icon) { // Added null check
                                icon.classList.remove('fa-chevron-down');
                                icon.classList.add('fa-chevron-up');
                            }
                        } else {
                            targetContent.style.maxHeight = null;
                            if (icon) { // Added null check
                                icon.classList.remove('fa-chevron-up');
                                icon.classList.add('fa-chevron-down');
                            }
                        }
                    } else {
                        console.error(`Элемент с ID '${targetId}' не найден для переключения фильтра.`);
                    }
                });
            });

            // Динамика вакансий (по месяцам) — как на скриншоте (bar, синие столбцы, белый фон)
            const jobTrendCtx = document.getElementById('jobTrendChart')?.getContext('2d');
            if (jobTrendCtx) {
                new Chart(jobTrendCtx, {
                    type: 'bar',
                    data: {
                        labels: ['Январь', 'Февраль', 'Март', 'Апрель', 'Май', 'Июнь', 'Июль', 'Август', 'Сентябрь', 'Октябрь', 'Ноябрь', 'Декабрь'],
                        datasets: [{
                            label: 'Вакансии',
                            data: [4, 5.8, 7.1, 6.3, 8.9, 7.2, 6.8, 5.5, 4.7, 5.2, 6.0, 7.3],
                            backgroundColor: 'rgba(59, 130, 246, 0.8)',
                            borderColor: 'rgba(59, 130, 246, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 10
                            }
                        },
                        plugins: {
                            legend: {
                                display: true,
                                position: 'top',
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return context.dataset.label + ': ' + context.parsed.y;
                                    }
                                }
                            }
                        }
                    }
                });
            }

            // 2. Распределение вакансий по отраслям (doughnut)
            const industryDistCtx = document.getElementById('industryDistributionChart')?.getContext('2d');
            if (industryDistCtx) {
                const industryChart = new Chart(industryDistCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['IT', 'Строительство', 'Торговля', 'Образование', 'Здравоохранение', 'Другие'],
                        datasets: [{
                            data: [18, 22, 25, 12, 8, 15],
                            backgroundColor: [
                                '#2563eb', // IT
                                '#22c55e', // Строительство
                                '#f59e42', // Торговля
                                '#a78bfa', // Образование
                                '#ef4444', // Здравоохранение
                                '#6b7280'  // Другие
                            ],
                            borderColor: '#fff',
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false },
                        }
                    },
                    plugins: [{
                        id: 'customLegend',
                        afterRender(chart) {
                            const legendBlock = document.getElementById('industryLegend');
                            if (legendBlock) {
                                const data = chart.data.datasets[0].data;
                                const total = data.reduce((a, b) => a + b, 0);
                                legendBlock.innerHTML = chart.data.labels.map((label, i) => {
                                    const percent = Math.round((data[i] / total) * 100);
                                    return `<div style="display:flex;align-items:center;margin-bottom:8px;">
                                        <span style="display:inline-block;width:16px;height:16px;background:${chart.data.datasets[0].backgroundColor[i]};border-radius:3px;margin-right:8px;"></span>
                                        <span style="font-size:15px;">${label} <b>${percent}%</b></span>
                                    </div>`;
                                }).join('');
                            }
                        }
                    }]
                });
            }

            // Гендерное распределение рынка труда (doughnut)
            const genderDistCtx = document.getElementById('genderDistributionChart')?.getContext('2d');
            if (genderDistCtx) {
                const genderChart = new Chart(genderDistCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Мужчины', 'Женщины', 'Не указано'],
                        datasets: [{
                            data: [54, 43, 3], // Примерные проценты
                            backgroundColor: [
                                '#2563eb', // Мужчины
                                '#f472b6', // Женщины
                                '#a3a3a3'  // Не указано
                            ],
                            borderColor: '#fff',
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false }
                        }
                    },
                    plugins: [{
                        id: 'customGenderLegend',
                        afterRender(chart) {
                            const legendBlock = document.getElementById('genderLegend');
                            if (legendBlock) {
                                const data = chart.data.datasets[0].data;
                                const total = data.reduce((a, b) => a + b, 0);
                                legendBlock.innerHTML = chart.data.labels.map((label, i) => {
                                    const percent = Math.round((data[i] / total) * 100);
                                    return `<div style="display:flex;align-items:center;margin-bottom:8px;">
                                        <span style="display:inline-block;width:16px;height:16px;background:${chart.data.datasets[0].backgroundColor[i]};border-radius:3px;margin-right:8px;"></span>
                                        <span style="font-size:15px;">${label} <b>${percent}%</b></span>
                                    </div>`;
                                }).join('');
                            }
                        }
                    }]
                });
            }

            // 3. Уровень безработицы по регионам (тренды) (line)
            const regionalUnempCtx = document.getElementById('regionalUnemploymentChart')?.getContext('2d');
            if (regionalUnempCtx) {
                new Chart(regionalUnempCtx, {
                    type: 'line',
                    data: {
                        labels: ['Январь', 'Февраль', 'Март', 'Апрель', 'Май', 'Июнь', 'Июль', 'Август', 'Сентябрь', 'Октябрь', 'Ноябрь', 'Декабрь'],
                        datasets: [
                            {
                                label: 'Душанбе',
                                data: [4.2, 4.3, 4.1, 4.0, 4.2, 4.4, 4.3, 4.1, 4.0, 4.2, 4.3, 4.1],
                                borderColor: '#3B82F6',
                                backgroundColor: 'rgba(59, 130, 246, 0.1)',
                                tension: 0.3,
                                fill: false
                            },
                            {
                                label: 'Худжанд',
                                data: [5.8, 5.7, 5.9, 5.6, 5.8, 5.7, 5.9, 5.6, 5.8, 5.7, 5.9, 5.6],
                                borderColor: '#10B981',
                                backgroundColor: 'rgba(16, 185, 129, 0.1)',
                                tension: 0.3,
                                fill: false
                            },
                            {
                                label: 'Куляб',
                                data: [7.1, 7.0, 7.2, 7.1, 7.0, 7.2, 7.1, 7.0, 7.2, 7.1, 7.0, 7.2],
                                borderColor: '#F59E0B',
                                backgroundColor: 'rgba(245, 158, 11, 0.1)',
                                tension: 0.3,
                                fill: false
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: true,
                                position: 'top',
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 10
                            }
                        }
                    }
                });
            }

            // Динамика вакансий по месяцам
            const ctxVacancies = document.getElementById('vacanciesTrendChart').getContext('2d');
            new Chart(ctxVacancies, {
                type: 'line',
                data: {
                    labels: ['Янв', 'Фев', 'Мар', 'Апр', 'Май', 'Июн', 'Июл', 'Авг', 'Сен', 'Окт', 'Ноя', 'Дек'],
                    datasets: [{
                        label: 'Количество вакансий',
                        data: [1200, 1350, 1500, 1700, 1600, 1800, 2000, 2100, 1950, 2200, 2300, 2400],
                        fill: true,
                        backgroundColor: 'rgba(59, 130, 246, 0.15)',
                        borderColor: 'rgba(59, 130, 246, 1)',
                        tension: 0.3,
                        pointBackgroundColor: 'rgba(59, 130, 246, 1)',
                        pointRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: true, position: 'top' },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': ' + context.parsed.y;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: { display: true, text: 'Вакансии' }
                        },
                        x: {
                            title: { display: true, text: 'Месяц' }
                        }
                    }
                }
            });

            // Initialize filter groups states (Existing)
            // Все фильтры свернуты по умолчанию
            document.querySelectorAll('.filter-group-content').forEach(content => {
                content.classList.remove('expanded');
                content.style.maxHeight = null;
                const button = content.previousElementSibling;
                const icon = button ? button.querySelector('i') : null;
                if (icon) {
                    icon.classList.remove('fa-chevron-up');
                    icon.classList.add('fa-chevron-down');
                }
            });

            // Populate Year/Month Selects and set defaults (Existing)
            const selectYear = document.getElementById('selectYear');
            const selectMonth = document.getElementById('selectMonth');
            const selectQuarter = document.getElementById('selectQuarter');
            const currentYear = new Date().getFullYear();
            const currentMonth = new Date().getMonth(); // 0-11

            if (selectYear) { // ADDED NULL CHECK
                for (let i = currentYear; i >= currentYear - 5; i--) {
                    const option = document.createElement('option');
                    option.value = i;
                    option.textContent = i;
                    selectYear.appendChild(option);
                }
                selectYear.value = currentYear;
            } else {
                console.error("Элемент с ID 'selectYear' не найден.");
            }

            if (selectMonth) { // ADDED NULL CHECK
                months.forEach((month, index) => {
                    const option = document.createElement('option');
                    option.value = index + 1;
                    option.textContent = month;
                    selectMonth.appendChild(option);
                });
                selectMonth.value = currentMonth + 1;
            } else {
                console.error("Элемент с ID 'selectMonth' не найден.");
            }

            document.querySelectorAll('input[name="period"]').forEach(radio => {
                radio.addEventListener('change', () => {
                    if (selectYear) selectYear.classList.add('hidden');
                    if (selectQuarter) selectQuarter.classList.add('hidden');
                    if (selectMonth) selectMonth.classList.add('hidden');

                    if (radio.value === 'year') {
                        if (selectYear) selectYear.classList.remove('hidden');
                    } else if (radio.value === 'quarter') {
                        if (selectYear) selectYear.classList.remove('hidden');
                        if (selectQuarter) selectQuarter.classList.remove('hidden');
                    } else if (radio.value === 'month') {
                        if (selectYear) selectYear.classList.remove('hidden');
                        if (selectMonth) selectMonth.classList.remove('hidden');
                    }
                    currentFiltersState.period = radio.value;
                    updateFiltersState();
                });
            });
            const initialPeriodRadio = document.querySelector('input[name="period"]:checked');
            if (initialPeriodRadio) { // ADDED NULL CHECK
                initialPeriodRadio.dispatchEvent(new Event('change'));
            } else {
                console.error("Не найдена выбранная радио-кнопка для периода.");
            }

            if (selectYear) selectYear.addEventListener('change', (e) => { currentFiltersState.year = e.target.value; updateFiltersState(); });
            if (selectQuarter) selectQuarter.addEventListener('change', (e) => { currentFiltersState.quarter = e.target.value; updateFiltersState(); });
            if (selectMonth) selectMonth.addEventListener('change', (e) => { currentFiltersState.month = e.target.value; updateFiltersState(); });

            document.querySelectorAll('input[name="region"], input[name="industry"], input[name="dataType"], input[name="ageGroup"], input[name="educationLevel"], input[name="experience"], input[name="socialStatus"]').forEach(input => {
                input.addEventListener('change', updateFiltersState);
            });
            document.querySelectorAll('input[name="gender"], input[name="employmentType"], input[name="companyType"]').forEach(input => {
                input.addEventListener('change', updateFiltersState);
            });
            document.getElementById('keywordsInput')?.addEventListener('input', updateFiltersState);
            document.getElementById('salaryMinInput')?.addEventListener('input', updateFiltersState);
            document.getElementById('salaryMaxInput')?.addEventListener('input', updateFiltersState);

            function updateFiltersState() {
                currentFiltersState.period = document.querySelector('input[name="period"]:checked')?.value || 'month';
                currentFiltersState.year = document.getElementById('selectYear')?.value || new Date().getFullYear();
                currentFiltersState.quarter = document.getElementById('selectQuarter')?.value || 'Q1';
                currentFiltersState.month = document.getElementById('selectMonth')?.value || (new Date().getMonth() + 1);

                currentFiltersState.regions = Array.from(document.querySelectorAll('input[name="region"]:checked')).map(cb => cb.value);
                currentFiltersState.industries = Array.from(document.querySelectorAll('input[name="industry"]:checked')).map(cb => cb.value);
                currentFiltersState.dataTypes = Array.from(document.querySelectorAll('input[name="dataType"]:checked')).map(cb => cb.value);
                currentFiltersState.ageGroups = Array.from(document.querySelectorAll('input[name="ageGroup"]:checked')).map(cb => cb.value);
                currentFiltersState.gender = document.querySelector('input[name="gender"]:checked')?.value || 'Не имеет значения';
                currentFiltersState.educationLevels = Array.from(document.querySelectorAll('input[name="educationLevel"]:checked')).map(cb => cb.value);
                currentFiltersState.experience = Array.from(document.querySelectorAll('input[name="experience"]:checked')).map(cb => cb.value);
                currentFiltersState.socialStatus = Array.from(document.querySelectorAll('input[name="socialStatus"]:checked')).map(cb => cb.value);
                currentFiltersState.keywords = document.getElementById('keywordsInput')?.value || '';
                currentFiltersState.salaryMin = document.getElementById('salaryMinInput')?.value || '';
                currentFiltersState.salaryMax = document.getElementById('salaryMaxInput')?.value || '';
                currentFiltersState.employmentType = document.querySelector('input[name="employmentType"]:checked')?.value || 'Полная занятость';
                currentFiltersState.companyType = document.querySelector('input[name="companyType"]:checked')?.value || 'Прямой работодатель';

                console.log('Текущее состояние фильтров:', currentFiltersState);
            }

            updateFiltersState(); // Initial update on load

            // "Apply Filters" button - for demonstration, it just logs the current state
            document.getElementById('applyFiltersBtn').addEventListener('click', () => {
                updateFiltersState();
                alert('Фильтры применены (состояние обновлено)! Проверьте консоль для деталей.');
            });

            // "Generate Report" button logic
            const generateReportBtn = document.getElementById('generateReportBtn');
            const reportLoadingSpinner = document.getElementById('reportLoadingSpinner');
            const reportOutputContainer = document.getElementById('reportOutputContainer'); // Changed to specific report output container
            const reportTableBody = document.getElementById('reportTableBody');

            generateReportBtn.addEventListener('click', async () => {
                reportLoadingSpinner.classList.remove('hidden');
                if (reportTableBody) reportTableBody.innerHTML = ''; // Clear previous report content, added null check
                if (reportOutputContainer) reportOutputContainer.classList.add('opacity-50', 'pointer-events-none'); // Dim and disable interaction, added null check

                // Simulate loading delay
                await new Promise(resolve => setTimeout(resolve, 1500));

                renderReportTable(5); // Generate 5 random rows

                reportLoadingSpinner.classList.add('hidden');
                if (reportOutputContainer) reportOutputContainer.classList.remove('opacity-50', 'pointer-events-none'); // Added null check
                if (reportOutputContainer) reportOutputContainer.classList.remove('hidden'); // Show the report container
            });

            // Initial render of the table when the page loads
            renderReportTable(5); // Render 5 random rows on initial load
        });
    </script>
</body>
</html>
