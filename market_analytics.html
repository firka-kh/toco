<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Аналитика рынка труда - Портал Рынка Труда</title>
    <meta name="description" content="Аналитика и статистика рынка труда Таджикистана. Зарплатные отчеты, тренды, прогнозы развития.">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <!-- Header -->
    <div id="header-placeholder"></div>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Page Header -->
        <section class="page-header">
            <div class="container">
                <div class="page-header-content">
                    <div class="breadcrumb">
                        <a href="index.html">Главная</a>
                        <i class="fas fa-chevron-right"></i>
                        <a href="#">Аналитика</a>
                        <i class="fas fa-chevron-right"></i>
                        <span>Аналитика рынка</span>
                    </div>
                    <h1 class="page-title">
                        <i class="fas fa-chart-line"></i>
                        Аналитика рынка труда
                    </h1>
                    <p class="page-subtitle">Актуальные данные и тренды рынка труда Республики Таджикистан</p>
                </div>
                <div class="page-actions">
                    <button class="btn btn-primary" id="generate-report">
                        <i class="fas fa-file-pdf"></i>
                        Создать отчет
                    </button>
                    <button class="btn btn-outline" id="export-data">
                        <i class="fas fa-download"></i>
                        Экспорт данных
                    </button>
                </div>
            </div>
        </section>

        <!-- Analytics Dashboard -->
        <section class="analytics-dashboard">
            <div class="container">
                <!-- Key Metrics -->
                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-icon">
                            <i class="fas fa-briefcase"></i>
                        </div>
                        <div class="metric-content">
                            <div class="metric-value" data-animate="counter" data-target="12450">0</div>
                            <div class="metric-label">Активные вакансии</div>
                            <div class="metric-change positive">
                                <i class="fas fa-arrow-up"></i>
                                +12% за месяц
                            </div>
                        </div>
                    </div>
                    
                    <div class="metric-card">
                        <div class="metric-icon">
                            <i class="fas fa-money-bill-wave"></i>
                        </div>
                        <div class="metric-content">
                            <div class="metric-value">3,250</div>
                            <div class="metric-label">Средняя зарплата (TJS)</div>
                            <div class="metric-change positive">
                                <i class="fas fa-arrow-up"></i>
                                +8% за год
                            </div>
                        </div>
                    </div>
                    
                    <div class="metric-card">
                        <div class="metric-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="metric-content">
                            <div class="metric-value" data-animate="counter" data-target="89320">0</div>
                            <div class="metric-label">Соискатели</div>
                            <div class="metric-change positive">
                                <i class="fas fa-arrow-up"></i>
                                +23% за год
                            </div>
                        </div>
                    </div>
                    
                    <div class="metric-card">
                        <div class="metric-icon">
                            <i class="fas fa-handshake"></i>
                        </div>
                        <div class="metric-content">
                            <div class="metric-value">76%</div>
                            <div class="metric-label">Успешность трудоустройства</div>
                            <div class="metric-change positive">
                                <i class="fas fa-arrow-up"></i>
                                +5% за квартал
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Charts Section -->
                <div class="charts-section">
                    <div class="charts-grid">
                        <!-- Vacancies by Region -->
                        <div class="chart-card">
                            <div class="chart-header">
                                <h3>Вакансии по регионам</h3>
                                <div class="chart-controls">
                                    <select id="region-period">
                                        <option value="month">За месяц</option>
                                        <option value="quarter">За квартал</option>
                                        <option value="year">За год</option>
                                    </select>
                                </div>
                            </div>
                            <div class="chart-container">
                                <canvas id="regionChart"></canvas>
                            </div>
                        </div>

                        <!-- Salary Trends -->
                        <div class="chart-card">
                            <div class="chart-header">
                                <h3>Динамика зарплат</h3>
                                <div class="chart-controls">
                                    <select id="salary-industry">
                                        <option value="all">Все сферы</option>
                                        <option value="it">ИТ</option>
                                        <option value="finance">Финансы</option>
                                        <option value="education">Образование</option>
                                        <option value="healthcare">Здравоохранение</option>
                                    </select>
                                </div>
                            </div>
                            <div class="chart-container">
                                <canvas id="salaryChart"></canvas>
                            </div>
                        </div>

                        <!-- Top Industries -->
                        <div class="chart-card">
                            <div class="chart-header">
                                <h3>Популярные сферы</h3>
                                <div class="chart-controls">
                                    <button class="chart-btn active" data-metric="vacancies">Вакансии</button>
                                    <button class="chart-btn" data-metric="candidates">Кандидаты</button>
                                </div>
                            </div>
                            <div class="chart-container">
                                <canvas id="industriesChart"></canvas>
                            </div>
                        </div>

                        <!-- Employment Types -->
                        <div class="chart-card">
                            <div class="chart-header">
                                <h3>Типы занятости</h3>
                                <div class="chart-legend" id="employment-legend"></div>
                            </div>
                            <div class="chart-container">
                                <canvas id="employmentChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Analytics Tables -->
                <div class="tables-section">
                    <!-- Salary by Industry -->
                    <div class="table-card">
                        <div class="table-header">
                            <h3>Зарплаты по отраслям</h3>
                            <button class="btn btn-outline btn-sm" id="export-salary-table">
                                <i class="fas fa-download"></i>
                                Экспорт
                            </button>
                        </div>
                        <div class="table-container">
                            <table class="data-table" id="salary-table">
                                <thead>
                                    <tr>
                                        <th>Отрасль</th>
                                        <th>Средняя зарплата</th>
                                        <th>Медианная зарплата</th>
                                        <th>Мин. зарплата</th>
                                        <th>Макс. зарплата</th>
                                        <th>Изменение</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>
                                            <div class="industry-cell">
                                                <i class="fas fa-laptop-code"></i>
                                                ИТ и программирование
                                            </div>
                                        </td>
                                        <td><strong>4,850 TJS</strong></td>
                                        <td>4,200 TJS</td>
                                        <td>2,500 TJS</td>
                                        <td>8,000 TJS</td>
                                        <td class="positive">+15%</td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <div class="industry-cell">
                                                <i class="fas fa-university"></i>
                                                Финансы и банки
                                            </div>
                                        </td>
                                        <td><strong>3,650 TJS</strong></td>
                                        <td>3,200 TJS</td>
                                        <td>1,800 TJS</td>
                                        <td>6,500 TJS</td>
                                        <td class="positive">+8%</td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <div class="industry-cell">
                                                <i class="fas fa-chart-line"></i>
                                                Продажи и маркетинг
                                            </div>
                                        </td>
                                        <td><strong>2,950 TJS</strong></td>
                                        <td>2,500 TJS</td>
                                        <td>1,500 TJS</td>
                                        <td>5,000 TJS</td>
                                        <td class="positive">+12%</td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <div class="industry-cell">
                                                <i class="fas fa-graduation-cap"></i>
                                                Образование
                                            </div>
                                        </td>
                                        <td><strong>2,150 TJS</strong></td>
                                        <td>2,000 TJS</td>
                                        <td>1,200 TJS</td>
                                        <td>3,500 TJS</td>
                                        <td class="positive">+6%</td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <div class="industry-cell">
                                                <i class="fas fa-heartbeat"></i>
                                                Здравоохранение
                                            </div>
                                        </td>
                                        <td><strong>2,350 TJS</strong></td>
                                        <td>2,100 TJS</td>
                                        <td>1,400 TJS</td>
                                        <td>4,000 TJS</td>
                                        <td class="positive">+4%</td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <div class="industry-cell">
                                                <i class="fas fa-cogs"></i>
                                                Производство
                                            </div>
                                        </td>
                                        <td><strong>2,850 TJS</strong></td>
                                        <td>2,600 TJS</td>
                                        <td>1,600 TJS</td>
                                        <td>4,500 TJS</td>
                                        <td class="positive">+7%</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Top Companies -->
                    <div class="table-card">
                        <div class="table-header">
                            <h3>Топ работодатели</h3>
                            <div class="table-filters">
                                <select id="company-filter">
                                    <option value="all">Все компании</option>
                                    <option value="large">Крупные</option>
                                    <option value="medium">Средние</option>
                                    <option value="small">Малые</option>
                                </select>
                            </div>
                        </div>
                        <div class="table-container">
                            <table class="data-table" id="companies-table">
                                <thead>
                                    <tr>
                                        <th>Компания</th>
                                        <th>Сфера деятельности</th>
                                        <th>Активные вакансии</th>
                                        <th>Просмотры</th>
                                        <th>Отклики</th>
                                        <th>Рейтинг</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>
                                            <div class="company-cell">
                                                <img src="https://via.placeholder.com/32x32" alt="TajSoft">
                                                TajSoft
                                            </div>
                                        </td>
                                        <td>ИТ и разработка</td>
                                        <td><strong>23</strong></td>
                                        <td>5,430</td>
                                        <td>1,250</td>
                                        <td>
                                            <div class="rating">
                                                <span class="stars">★★★★★</span>
                                                4.8
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <div class="company-cell">
                                                <img src="https://via.placeholder.com/32x32" alt="DushanbeTech">
                                                DushanbeTech
                                            </div>
                                        </td>
                                        <td>Цифровые решения</td>
                                        <td><strong>18</strong></td>
                                        <td>4,120</td>
                                        <td>980</td>
                                        <td>
                                            <div class="rating">
                                                <span class="stars">★★★★★</span>
                                                4.7
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <div class="company-cell">
                                                <img src="https://via.placeholder.com/32x32" alt="Tajik Bank">
                                                Tajik Bank
                                            </div>
                                        </td>
                                        <td>Банковские услуги</td>
                                        <td><strong>15</strong></td>
                                        <td>3,890</td>
                                        <td>750</td>
                                        <td>
                                            <div class="rating">
                                                <span class="stars">★★★★☆</span>
                                                4.5
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <div class="company-cell">
                                                <img src="https://via.placeholder.com/32x32" alt="EduTaj">
                                                EduTaj
                                            </div>
                                        </td>
                                        <td>Образование</td>
                                        <td><strong>12</strong></td>
                                        <td>2,340</td>
                                        <td>450</td>
                                        <td>
                                            <div class="rating">
                                                <span class="stars">★★★★☆</span>
                                                4.3
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <div class="company-cell">
                                                <img src="https://via.placeholder.com/32x32" alt="LogisTaj">
                                                LogisTaj
                                            </div>
                                        </td>
                                        <td>Логистика</td>
                                        <td><strong>14</strong></td>
                                        <td>2,780</td>
                                        <td>520</td>
                                        <td>
                                            <div class="rating">
                                                <span class="stars">★★★★☆</span>
                                                4.4
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Insights Section -->
                <div class="insights-section">
                    <h2>Ключевые инсайты</h2>
                    <div class="insights-grid">
                        <div class="insight-card">
                            <div class="insight-icon">
                                <i class="fas fa-trend-up"></i>
                            </div>
                            <div class="insight-content">
                                <h4>Рост IT-сектора</h4>
                                <p>Количество вакансий в IT-сфере выросло на 35% за последний год. Спрос на разработчиков и дизайнеров остается высоким.</p>
                                <div class="insight-meta">
                                    <span class="insight-category">Тренды</span>
                                    <span class="insight-date">Обновлено вчера</span>
                                </div>
                            </div>
                        </div>

                        <div class="insight-card">
                            <div class="insight-icon">
                                <i class="fas fa-globe"></i>
                            </div>
                            <div class="insight-content">
                                <h4>Удаленная работа</h4>
                                <p>28% новых вакансий предлагают возможность удаленной работы. Наибольший спрос в сферах маркетинга и IT.</p>
                                <div class="insight-meta">
                                    <span class="insight-category">Форматы работы</span>
                                    <span class="insight-date">3 дня назад</span>
                                </div>
                            </div>
                        </div>

                        <div class="insight-card">
                            <div class="insight-icon">
                                <i class="fas fa-graduation-cap"></i>
                            </div>
                            <div class="insight-content">
                                <h4>Требования к образованию</h4>
                                <p>43% работодателей готовы рассматривать кандидатов без высшего образования при наличии практических навыков.</p>
                                <div class="insight-meta">
                                    <span class="insight-category">Образование</span>
                                    <span class="insight-date">1 неделю назад</span>
                                </div>
                            </div>
                        </div>

                        <div class="insight-card">
                            <div class="insight-icon">
                                <i class="fas fa-video"></i>
                            </div>
                            <div class="insight-content">
                                <h4>Видеоинтервью</h4>
                                <p>67% компаний используют видеоинтервью для первичного отбора. Это сокращает время найма на 40%.</p>
                                <div class="insight-meta">
                                    <span class="insight-category">HR-технологии</span>
                                    <span class="insight-date">5 дней назад</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <div id="footer-placeholder"></div>

    <!-- Report Generation Modal -->
    <div class="modal" id="report-modal">
        <div class="modal-content large">
            <div class="modal-header">
                <h3>Создать аналитический отчет</h3>
                <button class="modal-close" id="report-modal-close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form class="report-form" id="report-form">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="report-type">Тип отчета</label>
                            <select id="report-type" required>
                                <option value="">Выберите тип</option>
                                <option value="salary">Анализ зарплат</option>
                                <option value="market">Обзор рынка</option>
                                <option value="industry">Анализ отрасли</option>
                                <option value="region">Региональный анализ</option>
                                <option value="trends">Анализ трендов</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="report-period">Период</label>
                            <select id="report-period" required>
                                <option value="">Выберите период</option>
                                <option value="month">Последний месяц</option>
                                <option value="quarter">Последний квартал</option>
                                <option value="year">Последний год</option>
                                <option value="custom">Пользовательский</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="report-region">Регион</label>
                            <select id="report-region">
                                <option value="all">Все регионы</option>
                                <option value="dushanbe">Душанбе</option>
                                <option value="sughd">Согдийская область</option>
                                <option value="khatlon">Хатлонская область</option>
                                <option value="gbao">ГБАО</option>
                                <option value="rrp">РРП</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="report-industry">Отрасль</label>
                            <select id="report-industry">
                                <option value="all">Все отрасли</option>
                                <option value="it">ИТ</option>
                                <option value="finance">Финансы</option>
                                <option value="education">Образование</option>
                                <option value="healthcare">Здравоохранение</option>
                                <option value="sales">Продажи</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Включить в отчет</label>
                        <div class="checkbox-group">
                            <label class="checkbox-label">
                                <input type="checkbox" name="include" value="charts" checked>
                                <span class="checkmark"></span>
                                Графики и диаграммы
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="include" value="tables" checked>
                                <span class="checkmark"></span>
                                Таблицы данных
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="include" value="insights">
                                <span class="checkmark"></span>
                                Аналитические выводы
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="include" value="recommendations">
                                <span class="checkmark"></span>
                                Рекомендации
                            </label>
                        </div>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-outline" id="preview-report">
                            <i class="fas fa-eye"></i>
                            Предпросмотр
                        </button>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-download"></i>
                            Создать отчет
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
    <script>
        // Chart instances
        let regionChart, salaryChart, industriesChart, employmentChart;

        // Mock data
        const analyticsData = {
            regionVacancies: {
                labels: ['Душанбе', 'Согдийская обл.', 'Хатлонская обл.', 'ГБАО', 'РРП'],
                data: [5420, 3280, 2150, 890, 710]
            },
            salaryTrends: {
                labels: ['Янв', 'Фев', 'Мар', 'Апр', 'Май', 'Июн'],
                datasets: {
                    all: [2980, 3050, 3120, 3180, 3220, 3250],
                    it: [4200, 4350, 4500, 4650, 4750, 4850],
                    finance: [3200, 3250, 3300, 3450, 3550, 3650],
                    education: [1950, 2000, 2050, 2100, 2120, 2150],
                    healthcare: [2100, 2150, 2200, 2250, 2300, 2350]
                }
            },
            topIndustries: {
                labels: ['ИТ', 'Финансы', 'Продажи', 'Образование', 'Здравоохранение', 'Производство'],
                vacancies: [2340, 1850, 1650, 1420, 1280, 1150],
                candidates: [3200, 2800, 4100, 5200, 3800, 2900]
            },
            employmentTypes: {
                labels: ['Полная занятость', 'Частичная занятость', 'Удаленная работа', 'Фриланс', 'Стажировка'],
                data: [68, 15, 12, 3, 2],
                colors: ['#0078D4', '#4FC3F7', '#00A1F1', '#5DADE2', '#85C1E9']
            }
        };

        document.addEventListener('DOMContentLoaded', function() {
            initializeCharts();
            setupEventListeners();
            animateCounters();
        });

        function initializeCharts() {
            // Region Vacancies Chart
            const regionCtx = document.getElementById('regionChart').getContext('2d');
            regionChart = new Chart(regionCtx, {
                type: 'bar',
                data: {
                    labels: analyticsData.regionVacancies.labels,
                    datasets: [{
                        label: 'Количество вакансий',
                        data: analyticsData.regionVacancies.data,
                        backgroundColor: 'rgba(0, 120, 212, 0.8)',
                        borderColor: '#0078D4',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });

            // Salary Trends Chart
            const salaryCtx = document.getElementById('salaryChart').getContext('2d');
            salaryChart = new Chart(salaryCtx, {
                type: 'line',
                data: {
                    labels: analyticsData.salaryTrends.labels,
                    datasets: [{
                        label: 'Средняя зарплата (TJS)',
                        data: analyticsData.salaryTrends.datasets.all,
                        borderColor: '#0078D4',
                        backgroundColor: 'rgba(0, 120, 212, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false
                        }
                    }
                }
            });

            // Top Industries Chart
            const industriesCtx = document.getElementById('industriesChart').getContext('2d');
            industriesChart = new Chart(industriesCtx, {
                type: 'horizontalBar',
                data: {
                    labels: analyticsData.topIndustries.labels,
                    datasets: [{
                        label: 'Количество вакансий',
                        data: analyticsData.topIndustries.vacancies,
                        backgroundColor: 'rgba(79, 195, 247, 0.8)',
                        borderColor: '#4FC3F7',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: true
                        }
                    }
                }
            });

            // Employment Types Chart
            const employmentCtx = document.getElementById('employmentChart').getContext('2d');
            employmentChart = new Chart(employmentCtx, {
                type: 'doughnut',
                data: {
                    labels: analyticsData.employmentTypes.labels,
                    datasets: [{
                        data: analyticsData.employmentTypes.data,
                        backgroundColor: analyticsData.employmentTypes.colors,
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });

            // Create custom legend for employment chart
            createEmploymentLegend();
        }

        function createEmploymentLegend() {
            const legend = document.getElementById('employment-legend');
            const data = analyticsData.employmentTypes;
            
            legend.innerHTML = data.labels.map((label, index) => `
                <div class="legend-item">
                    <div class="legend-color" style="background-color: ${data.colors[index]}"></div>
                    <span>${label}</span>
                    <strong>${data.data[index]}%</strong>
                </div>
            `).join('');
        }

        function setupEventListeners() {
            // Chart controls
            document.getElementById('salary-industry').addEventListener('change', function() {
                updateSalaryChart(this.value);
            });

            document.querySelectorAll('.chart-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.chart-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    updateIndustriesChart(this.dataset.metric);
                });
            });

            // Report generation
            document.getElementById('generate-report').addEventListener('click', function() {
                document.getElementById('report-modal').classList.add('show');
                document.body.style.overflow = 'hidden';
            });

            document.getElementById('report-modal-close').addEventListener('click', function() {
                document.getElementById('report-modal').classList.remove('show');
                document.body.style.overflow = '';
            });

            document.getElementById('report-form').addEventListener('submit', function(e) {
                e.preventDefault();
                generateReport();
            });

            document.getElementById('preview-report').addEventListener('click', function() {
                previewReport();
            });

            // Export data
            document.getElementById('export-data').addEventListener('click', function() {
                exportAnalyticsData();
            });

            document.getElementById('export-salary-table').addEventListener('click', function() {
                exportSalaryTable();
            });

            // Modal close on backdrop click
            document.getElementById('report-modal').addEventListener('click', function(e) {
                if (e.target === this) {
                    this.classList.remove('show');
                    document.body.style.overflow = '';
                }
            });
        }

        function updateSalaryChart(industry) {
            const data = analyticsData.salaryTrends.datasets[industry] || analyticsData.salaryTrends.datasets.all;
            salaryChart.data.datasets[0].data = data;
            salaryChart.update();
        }

        function updateIndustriesChart(metric) {
            const data = metric === 'candidates' ? 
                analyticsData.topIndustries.candidates : 
                analyticsData.topIndustries.vacancies;
            
            industriesChart.data.datasets[0].data = data;
            industriesChart.data.datasets[0].label = metric === 'candidates' ? 'Количество кандидатов' : 'Количество вакансий';
            industriesChart.update();
        }

        function animateCounters() {
            const counters = document.querySelectorAll('[data-animate="counter"]');
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting && !entry.target.dataset.animated) {
                        const target = parseInt(entry.target.dataset.target);
                        PortalUtils.animateCounter(entry.target, target);
                        entry.target.dataset.animated = 'true';
                    }
                });
            }, { threshold: 0.5 });

            counters.forEach(counter => {
                observer.observe(counter);
            });
        }

        function generateReport() {
            const formData = new FormData(document.getElementById('report-form'));
            const reportType = formData.get('report-type');
            const period = formData.get('report-period');
            const region = formData.get('report-region');
            const industry = formData.get('report-industry');
            
            // Show loading state
            const submitBtn = document.querySelector('#report-form button[type="submit"]');
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Создание отчета...';
            submitBtn.disabled = true;

            // Simulate report generation
            setTimeout(() => {
                // Create mock PDF content
                const reportContent = createReportContent(reportType, period, region, industry);
                downloadReport(reportContent, `analytics-report-${Date.now()}.pdf`);
                
                // Reset button
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
                
                // Close modal
                document.getElementById('report-modal').classList.remove('show');
                document.body.style.overflow = '';
                
                PortalUtils.showNotification('Отчет успешно создан и загружен!', 'success');
            }, 3000);
        }

        function createReportContent(type, period, region, industry) {
            return `
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Аналитический отчет</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 40px; }
                        .header { text-align: center; margin-bottom: 30px; }
                        .section { margin-bottom: 25px; }
                        .table { width: 100%; border-collapse: collapse; }
                        .table th, .table td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                        .table th { background-color: #f2f2f2; }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>Аналитический отчет рынка труда</h1>
                        <p>Тип: ${type} | Период: ${period} | Регион: ${region} | Отрасль: ${industry}</p>
                        <p>Дата создания: ${new Date().toLocaleDateString('ru-RU')}</p>
                    </div>
                    
                    <div class="section">
                        <h2>Ключевые метрики</h2>
                        <table class="table">
                            <tr><th>Показатель</th><th>Значение</th><th>Изменение</th></tr>
                            <tr><td>Активные вакансии</td><td>12,450</td><td>+12%</td></tr>
                            <tr><td>Средняя зарплата</td><td>3,250 TJS</td><td>+8%</td></tr>
                            <tr><td>Соискатели</td><td>89,320</td><td>+23%</td></tr>
                            <tr><td>Успешность трудоустройства</td><td>76%</td><td>+5%</td></tr>
                        </table>
                    </div>
                    
                    <div class="section">
                        <h2>Зарплаты по отраслям</h2>
                        <table class="table">
                            <tr><th>Отрасль</th><th>Средняя зарплата</th><th>Изменение</th></tr>
                            <tr><td>ИТ и программирование</td><td>4,850 TJS</td><td>+15%</td></tr>
                            <tr><td>Финансы и банки</td><td>3,650 TJS</td><td>+8%</td></tr>
                            <tr><td>Продажи и маркетинг</td><td>2,950 TJS</td><td>+12%</td></tr>
                            <tr><td>Образование</td><td>2,150 TJS</td><td>+6%</td></tr>
                            <tr><td>Здравоохранение</td><td>2,350 TJS</td><td>+4%</td></tr>
                        </table>
                    </div>
                    
                    <div class="section">
                        <h2>Рекомендации</h2>
                        <ul>
                            <li>IT-сектор показывает наибольший рост - рекомендуется инвестировать в развитие технических навыков</li>
                            <li>Удаленная работа становится все более популярной - 28% новых вакансий</li>
                            <li>Видеоинтервью используют 67% компаний - важно адаптироваться к новым форматам</li>
                        </ul>
                    </div>
                </body>
                </html>
            `;
        }

        function downloadReport(content, filename) {
            const blob = new Blob([content], { type: 'text/html' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
            document.body.removeChild(a);
        }

        function previewReport() {
            PortalUtils.showNotification('Предпросмотр отчета будет доступен в следующей версии', 'info');
        }

        function exportAnalyticsData() {
            const csvContent = `Регион,Вакансии,Процент
Душанбе,5420,43.5%
Согдийская область,3280,26.3%
Хатлонская область,2150,17.3%
ГБАО,890,7.1%
РРП,710,5.8%`;

            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'analytics-data.csv';
            link.click();
        }

        function exportSalaryTable() {
            const csvContent = `Отрасль,Средняя зарплата,Медианная зарплата,Мин зарплата,Макс зарплата,Изменение
ИТ и программирование,4850,4200,2500,8000,+15%
Финансы и банки,3650,3200,1800,6500,+8%
Продажи и маркетинг,2950,2500,1500,5000,+12%
Образование,2150,2000,1200,3500,+6%
Здравоохранение,2350,2100,1400,4000,+4%
Производство,2850,2600,1600,4500,+7%`;

            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'salary-data.csv';
            link.click();
            
            PortalUtils.showNotification('Данные экспортированы в CSV файл', 'success');
        }
    </script>
</body>
</html>
